<%- include('./partials/header') %>

<div class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
    <!-- Header Section -->
    <div class="bg-white/80 backdrop-blur-sm shadow-sm border-b pt-16">
        <div class="max-w-7xl mx-auto px-6 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-slate-800 to-blue-700 bg-clip-text text-transparent">All Products</h1>
                    <p class="text-sm text-slate-600 mt-1">Discover our curated collection</p>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-sm font-medium text-slate-700">Sort by:</span>
                    <form action="/shop" method="GET" class="inline-block">
                        <select name="sortby" onchange="this.form.submit()" 
                            class="bg-white border-2 border-slate-200 rounded-xl px-4 py-2.5 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 shadow-sm hover:shadow-md">
                            <option value="popular">Most Popular</option>
                            <option value="newest">Newest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="discount">Highest Discount</option>
                        </select>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-6 py-8">
        <div class="flex gap-8">
            <!-- Sidebar Filters -->
            <aside class="w-72 flex-shrink-0">
                <div class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-lg border border-white/50">
                    <!-- Categories -->
                    <div class="p-6 border-b border-slate-100">
                        <h3 class="font-bold text-slate-800 mb-4 text-lg">Categories</h3>
                        <div class="space-y-3">
                            <a href="/shop" class="group flex items-center text-sm text-slate-600 hover:text-blue-600 transition-all duration-200 p-2 rounded-lg hover:bg-blue-50">
                                <span class="w-2 h-2 bg-blue-500 rounded-full mr-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></span>
                                All Products
                            </a>
                            <a href="/shop?category=new" class="group flex items-center text-sm text-slate-600 hover:text-blue-600 transition-all duration-200 p-2 rounded-lg hover:bg-blue-50">
                                <span class="w-2 h-2 bg-blue-500 rounded-full mr-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></span>
                                New Collection
                            </a>
                            <a href="/shop?discount=true" class="group flex items-center text-sm text-slate-600 hover:text-blue-600 transition-all duration-200 p-2 rounded-lg hover:bg-blue-50">
                                <span class="w-2 h-2 bg-blue-500 rounded-full mr-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></span>
                                Discounted Products
                            </a>
                        </div>
                    </div>

                    <!-- Price Filter -->
                    <div class="p-6 border-b border-slate-100">
                        <h3 class="font-bold text-slate-800 mb-4 text-lg">Price Range</h3>
                        <div class="space-y-3">
                            <label class="flex items-center group cursor-pointer p-2 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                                <input type="radio" name="price" class="mr-3 text-blue-600 focus:ring-blue-500 focus:ring-2" value="0-500">
                                <span class="text-sm text-slate-700 group-hover:text-slate-900">Under ₹500</span>
                            </label>
                            <label class="flex items-center group cursor-pointer p-2 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                                <input type="radio" name="price" class="mr-3 text-blue-600 focus:ring-blue-500 focus:ring-2" value="500-1000">
                                <span class="text-sm text-slate-700 group-hover:text-slate-900">₹500 - ₹1,000</span>
                            </label>
                            <label class="flex items-center group cursor-pointer p-2 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                                <input type="radio" name="price" class="mr-3 text-blue-600 focus:ring-blue-500 focus:ring-2" value="1000-2000">
                                <span class="text-sm text-slate-700 group-hover:text-slate-900">₹1,000 - ₹2,000</span>
                            </label>
                            <label class="flex items-center group cursor-pointer p-2 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                                <input type="radio" name="price" class="mr-3 text-blue-600 focus:ring-blue-500 focus:ring-2" value="2000+">
                                <span class="text-sm text-slate-700 group-hover:text-slate-900">Above ₹2,000</span>
                            </label>
                        </div>
                    </div>

                    <!-- Availability Filter -->
                    <div class="p-6 border-b border-slate-100">
                        <h3 class="font-bold text-slate-800 mb-4 text-lg">Availability</h3>
                        <div class="space-y-3">
                            <label class="flex items-center group cursor-pointer p-2 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                                <input type="checkbox" class="mr-3 text-blue-600 focus:ring-blue-500 focus:ring-2 rounded">
                                <span class="text-sm text-slate-700 group-hover:text-slate-900">In Stock</span>
                            </label>
                            <label class="flex items-center group cursor-pointer p-2 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                                <input type="checkbox" class="mr-3 text-blue-600 focus:ring-blue-500 focus:ring-2 rounded">
                                <span class="text-sm text-slate-700 group-hover:text-slate-900">On Sale</span>
                            </label>
                        </div>
                    </div>

                    <!-- Discount Filter -->
                    <div class="p-6">
                        <h3 class="font-bold text-slate-800 mb-4 text-lg">Discount</h3>
                        <div class="space-y-3">
                            <label class="flex items-center group cursor-pointer p-2 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                                <input type="checkbox" class="mr-3 text-blue-600 focus:ring-blue-500 focus:ring-2 rounded">
                                <span class="text-sm text-slate-700 group-hover:text-slate-900">10% and above</span>
                            </label>
                            <label class="flex items-center group cursor-pointer p-2 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                                <input type="checkbox" class="mr-3 text-blue-600 focus:ring-blue-500 focus:ring-2 rounded">
                                <span class="text-sm text-slate-700 group-hover:text-slate-900">25% and above</span>
                            </label>
                            <label class="flex items-center group cursor-pointer p-2 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                                <input type="checkbox" class="mr-3 text-blue-600 focus:ring-blue-500 focus:ring-2 rounded">
                                <span class="text-sm text-slate-700 group-hover:text-slate-900">50% and above</span>
                            </label>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Products Grid -->
            <main class="flex-1">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <% products.forEach(function(product){ %>
                        <%
                            // Ensure we have valid numbers
                            const originalPrice = parseFloat(product.price) || 0;
                            const discountPercent = parseFloat(product.discount) || 0;
                            
                            // Calculate discounted price
                            let finalPrice = originalPrice;
                            let hasDiscount = false;
                            
                            if (discountPercent > 0 && discountPercent <= 100) {
                                finalPrice = originalPrice - (originalPrice * (discountPercent / 100));
                                hasDiscount = true;
                            }
                            
                            // Ensure no negative prices
                            finalPrice = Math.max(finalPrice, 0);
                        %>
                        
                        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/50 hover:shadow-2xl hover:scale-105 transition-all duration-300 group overflow-hidden">
                            <!-- Product Image -->
                            <div class="relative overflow-hidden rounded-t-2xl">
                                <div class="aspect-square bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center p-6" 
                                     style="background: linear-gradient(135deg, <%= product.bgcolor || '#f8fafc' %>, <%= product.bgcolor || '#f1f5f9' %>);">
                                    <% if(product.image) { %>
                                        <img class="w-full h-full object-contain group-hover:scale-110 transition-transform duration-500" 
                                             src="data:image/jpeg;base64,<%= product.image.toString('base64') %>"
                                             alt="<%= product.name %>"
                                             loading="lazy">
                                    <% } else { %>
                                        <div class="w-full h-full bg-gradient-to-br from-slate-100 to-slate-200 flex items-center justify-center rounded-xl">
                                            <i class="ri-image-line text-6xl text-slate-400"></i>
                                        </div>
                                    <% } %>
                                </div>
                                
                                <!-- Discount Badge -->
                                <% if(hasDiscount) { %>
                                    <div class="absolute top-4 left-4 bg-gradient-to-r from-red-500 to-pink-500 text-white px-3 py-1.5 rounded-full text-xs font-bold shadow-lg">
                                        <%= Math.round(discountPercent) %>% OFF
                                    </div>
                                <% } %>
                                
                                <!-- Quick Actions -->
                                <!-- <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                                    <button class="w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full shadow-lg flex items-center justify-center hover:bg-white hover:scale-110 transition-all duration-200 mb-2">
                                        <i class="ri-heart-line text-slate-700 hover:text-red-500"></i>
                                    </button>
                                    <button class="w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full shadow-lg flex items-center justify-center hover:bg-white hover:scale-110 transition-all duration-200">
                                        <i class="ri-eye-line text-slate-700 hover:text-blue-500"></i>
                                    </button>
                                </div> -->
                            </div>

                            <!-- Product Info -->
                            <div class="p-6">
                                <h3 class="font-bold text-slate-800 mb-3 line-clamp-2 group-hover:text-blue-600 transition-colors duration-200 text-lg leading-tight">
                                    <%= product.name || 'Unnamed Product' %>
                                </h3>
                                
                                <!-- Price Section -->
                                <div class="flex items-center gap-2 mb-4">
                                    <% if(hasDiscount) { %>
                                        <!-- Show discounted price first, then crossed original price -->
                                        <span class="text-xl font-bold text-slate-900">
                                            ₹<%= Math.round(finalPrice).toLocaleString('en-IN') %>
                                        </span>
                                        <span class="text-sm text-slate-500 line-through">
                                            ₹<%= Math.round(originalPrice).toLocaleString('en-IN') %>
                                        </span>
                                        <span class="text-xs bg-gradient-to-r from-green-100 to-emerald-100 text-green-800 px-2.5 py-1 rounded-full font-bold">
                                            Save ₹<%= Math.round(originalPrice - finalPrice).toLocaleString('en-IN') %>
                                        </span>
                                    <% } else { %>
                                        <!-- Show only original price -->
                                        <span class="text-xl font-bold text-slate-900">
                                            ₹<%= Math.round(originalPrice).toLocaleString('en-IN') %>
                                        </span>
                                    <% } %>
                                </div>

                                <!-- Debug Info (Remove after testing) -->
                                <% if(process.env.NODE_ENV === 'development') { %>
                                    <div class="text-xs bg-yellow-50 text-yellow-800 p-3 rounded-lg mb-3 border border-yellow-200">
                                        <strong>Debug:</strong><br>
                                        Original: ₹<%= originalPrice %><br>
                                        Discount: <%= discountPercent %>%<br>
                                        Final: ₹<%= finalPrice %><br>
                                        Has Discount: <%= hasDiscount %>
                                    </div>
                                <% } %>

                                <!-- Rating -->
                                <div class="flex items-center gap-2 mb-5">
                                    <div class="flex text-yellow-400">
                                        <i class="ri-star-fill text-sm"></i>
                                        <i class="ri-star-fill text-sm"></i>
                                        <i class="ri-star-fill text-sm"></i>
                                        <i class="ri-star-fill text-sm"></i>
                                        <i class="ri-star-line text-sm"></i>
                                    </div>
                                    <span class="text-xs text-slate-500 font-medium">(4.0)</span>
                                </div>

                                <!-- Action Buttons -->
                                <div class="flex gap-3">
                                    <a href="/addtocart/<%=product._id%>" class="flex-1">
                                        <button class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-4 py-3 rounded-xl text-sm font-bold transition-all duration-200 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                            <i class="ri-shopping-cart-line"></i>
                                            Add to Cart
                                        </button>
                                    </a>
                                    <!-- <button class="w-12 h-12 border-2 border-slate-200 rounded-xl flex items-center justify-center hover:bg-slate-50 hover:border-slate-300 transition-all duration-200 group">
                                        <i class="ri-heart-line text-slate-600 group-hover:text-red-500 transition-colors duration-200"></i>
                                    </button> -->
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>

                <!-- Empty State -->
                <% if(!products || products.length === 0) { %>
                    <div class="text-center py-16">
                        <div class="w-32 h-32 bg-gradient-to-br from-slate-100 to-blue-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="ri-shopping-bag-line text-5xl text-slate-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-slate-900 mb-3">No products found</h3>
                        <p class="text-slate-500 text-lg">Try adjusting your filters or search criteria</p>
                    </div>
                <% } %>

                <!-- Load More Button -->
                <% if(products && products.length > 0) { %>
                    <div class="text-center mt-12">
                        <button class="bg-white/80 backdrop-blur-sm border-2 border-slate-200 text-slate-700 px-8 py-3 rounded-xl hover:bg-white hover:shadow-lg transition-all duration-200 font-semibold">
                            Load More Products
                        </button>
                    </div>
                <% } %>
            </main>
        </div>
    </div>
</div>

<!-- Filter Functionality Script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add hover effects for category links
        const categoryLinks = document.querySelectorAll('aside a');
        categoryLinks.forEach(link => {
            link.addEventListener('mouseenter', function() {
                const dot = this.querySelector('span');
                if (dot) dot.classList.remove('opacity-0');
            });
            
            link.addEventListener('mouseleave', function() {
                const dot = this.querySelector('span');
                if (dot && !this.classList.contains('active')) {
                    dot.classList.add('opacity-0');
                }
            });
        });

        // Handle filter changes
        const filterInputs = document.querySelectorAll('input[type="radio"], input[type="checkbox"]');
        filterInputs.forEach(input => {
            input.addEventListener('change', function() {
                console.log('Filter changed:', this.name, this.value, this.checked);
            });
        });
    });
</script>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .aspect-square {
        aspect-ratio: 1 / 1;
    }
    
    /* Custom backdrop blur for better browser support */
    .backdrop-blur-sm {
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
    }
    
    /* Smooth animations */
    * {
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Enhanced focus states */
    input:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    /* Glass morphism effect */
    .bg-white\/80 {
        background-color: rgba(255, 255, 255, 0.8);
    }
    
    .bg-white\/70 {
        background-color: rgba(255, 255, 255, 0.7);
    }
    
    .bg-white\/90 {
        background-color: rgba(255, 255, 255, 0.9);
    }
</style>

<%- include('./partials/footer') %>